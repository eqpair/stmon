<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>듀얼 계산기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .btn {
            @apply p-3 rounded-lg font-medium transition-all duration-200 ease-in-out transform hover:scale-105 active:scale-95;
        }

        .btn-number {
            @apply bg-gray-100 text-gray-800 hover:bg-gray-200;
        }

        .btn-operator {
            @apply bg-indigo-100 text-indigo-800 hover:bg-indigo-200;
        }

        .btn-clear {
            @apply bg-red-500 text-white hover:bg-red-600;
        }

        .btn-equals {
            @apply bg-indigo-600 text-white hover:bg-indigo-700;
        }

        .display {
            @apply w-full p-3 mb-4 border-none rounded-lg bg-gray-50 text-right text-2xl font-mono shadow-inner;
        }

        .history-entry {
            @apply flex justify-between items-center mb-2 p-2 rounded hover:bg-gray-100 transition;
        }

        .history-delete {
            @apply bg-red-500 text-white text-xs px-2 py-1 rounded hover:bg-red-600;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-indigo-100 to-gray-200 flex items-center justify-center min-h-screen">
    <div class="container mx-auto p-6">
        <h1 class="text-4xl font-bold text-center mb-10 text-indigo-800">듀얼 계산기</h1>
        <div class="flex flex-col md:flex-row gap-6 justify-center">
            <!-- 계산기 1 -->
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full md:w-1/2 max-w-md">
                <h2 class="text-2xl font-semibold mb-4 text-center text-indigo-700">계산기 1</h2>
                <input type="text" id="display1" class="display" readonly>
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="clearDisplay(1)" class="btn btn-clear">C</button>
                    <button onclick="appendToDisplay(1, '(')" class="btn btn-operator">(</button>
                    <button onclick="appendToDisplay(1, ')')" class="btn btn-operator">)</button>
                    <button onclick="appendToDisplay(1, '/')" class="btn btn-operator">/</button>
                    <button onclick="appendToDisplay(1, '7')" class="btn btn-number">7</button>
                    <button onclick="appendToDisplay(1, '8')" class="btn btn-number">8</button>
                    <button onclick="appendToDisplay(1, '9')" class="btn btn-number">9</button>
                    <button onclick="appendToDisplay(1, '*')" class="btn btn-operator">×</button>
                    <button onclick="appendToDisplay(1, '4')" class="btn btn-number">4</button>
                    <button onclick="appendToDisplay(1, '5')" class="btn btn-number">5</button>
                    <button onclick="appendToDisplay(1, '6')" class="btn btn-number">6</button>
                    <button onclick="appendToDisplay(1, '-')" class="btn btn-operator">-</button>
                    <button onclick="appendToDisplay(1, '1')" class="btn btn-number">1</button>
                    <button onclick="appendToDisplay(1, '2')" class="btn btn-number">2</button>
                    <button onclick="appendToDisplay(1, '3')" class="btn btn-number">3</button>
                    <button onclick="appendToDisplay(1, '+')" class="btn btn-operator">+</button>
                    <button onclick="appendToDisplay(1, '0')" class="btn btn-number col-span-2">0</button>
                    <button onclick="appendToDisplay(1, '.')" class="btn btn-number">.</button>
                    <button onclick="calculate(1)" class="btn btn-equals">=</button>
                </div>
                <div class="mt-6">
                    <h3 class="text-lg font-medium text-indigo-700">입력 기록</h3>
                    <div id="history1" class="bg-gray-50 p-3 rounded-lg h-32 overflow-y-auto text-sm"></div>
                    <button onclick="clearHistory(1)" class="mt-3 btn btn-clear w-full">전체 기록 삭제</button>
                </div>
            </div>
            <!-- 계산기 2 -->
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full md:w-1/2 max-w-md">
                <h2 class="text-2xl font-semibold mb-4 text-center text-indigo-700">계산기 2</h2>
                <input type="text" id="display2" class="display" readonly>
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="clearDisplay(2)" class="btn btn-clear">C</button>
                    <button onclick="appendToDisplay(2, '(')" class="btn btn-operator">(</button>
                    <button onclick="appendToDisplay(2, ')')" class="btn btn-operator">)</button>
                    <button onclick="appendToDisplay(2, '/')" class="btn btn-operator">/</button>
                    <button onclick="appendToDisplay(2, '7')" class="btn btn-number">7</button>
                    <button onclick="appendToDisplay(2, '8')" class="btn btn-number">8</button>
                    <button onclick="appendToDisplay(2, '9')" class="btn btn-number">9</button>
                    <button onclick="appendToDisplay(2, '*')" class="btn btn-operator">×</button>
                    <button onclick="appendToDisplay(2, '4')" class="btn btn-number">4</button>
                    <button onclick="appendToDisplay(2, '5')" class="btn btn-number">5</button>
                    <button onclick="appendToDisplay(2, '6')" class="btn btn-number">6</button>
                    <button onclick="appendToDisplay(2, '-')" class="btn btn-operator">-</button>
                    <button onclick="appendToDisplay(2, '1')" class="btn btn-number">1</button>
                    <button onclick="appendToDisplay(2, '2')" class="btn btn-number">2</button>
                    <button onclick="appendToDisplay(2, '3')" class="btn btn-number">3</button>
                    <button onclick="appendToDisplay(2, '+')" class="btn btn-operator">+</button>
                    <button onclick="appendToDisplay(2, '0')" class="btn btn-number col-span-2">0</button>
                    <button onclick="appendToDisplay(2, '.')" class="btn btn-number">.</button>
                    <button onclick="calculate(2)" class="btn btn-equals">=</button>
                </div>
                <div class="mt-6">
                    <h3 class="text-lg font-medium text-indigo-700">입력 기록</h3>
                    <div id="history2" class="bg-gray-50 p-3 rounded-lg h-32 overflow-y-auto text-sm"></div>
                    <button onclick="clearHistory(2)" class="mt-3 btn btn-clear w-full">전체 기록 삭제</button>
                </div>
            </div>
        </div>
    </div>
    <script>
    // 각 계산기의 마지막 연산을 저장
    const lastOperations = { 1: null, 2: null };

    function appendToDisplay(calcId, value) {
      const display = document.getElementById(`display${calcId}`);
      display.value += value;
    }

    function clearDisplay(calcId) {
      const display = document.getElementById(`display${calcId}`);
      display.value = '';
      lastOperations[calcId] = null; // 연산 초기화
    }

    function clearHistory(calcId) {
      const history = document.getElementById(`history${calcId}`);
      history.innerHTML = '';
    }

    function deleteHistoryEntry(calcId, index) {
      const history = document.getElementById(`history${calcId}`);
      const entries = history.getElementsByTagName('div');
      if (entries[index]) {
        entries[index].remove();
      }
    }

    function formatNumberWithCommas(num) {
        if (typeof num === 'number') {
            return num.toLocaleString('ko-KR');
        }
        return num;
    }

    function calculate(calcId) {
        const display = document.getElementById(`display${calcId}`);
        const history = document.getElementById(`history${calcId}`);
        try {
            // 디스플레이에 숫자만 있는 경우 (이전 계산 결과)
            if (lastOperations[calcId] && !isNaN(parseFloat(display.value))) {
                const lastOp = lastOperations[calcId];
                const newExpression = `${display.value}${lastOp}`;
                // eval 하기 전에 수식 내 × 기호 교체
                const safeExpression = newExpression.replace(/×/g, '*');
                const result = eval(safeExpression);
                const entryIndex = history.getElementsByTagName('div').length;

                history.innerHTML += `
            <div class="history-entry">
            <p>${newExpression} = ${formatNumberWithCommas(result)}</p>
            <button onclick="deleteHistoryEntry(${calcId}, ${entryIndex})" class="history-delete">삭제</button>
            </div>`;
                display.value = formatNumberWithCommas(result);
                history.scrollTop = history.scrollHeight;
                return;
            }

            // 새로운 연산 처리
            const expression = display.value.replace(/×/g, '*');
            const result = eval(expression); // 실제 프로덕션에서는 안전한 파서 사용 권장
            const entryIndex = history.getElementsByTagName('div').length;

            // 마지막 연산자 및 숫자 추출 (예: "5*5" -> "*5")
            const match = expression.match(/([+\-*/])([^+\-*/()]+)$/);
            lastOperations[calcId] = match ? match[1] + match[2] : null;

            history.innerHTML += `
        <div class="history-entry">
            <p>${display.value} = ${formatNumberWithCommas(result)}</p>
            <button onclick="deleteHistoryEntry(${calcId}, ${entryIndex})" class="history-delete">삭제</button>
        </div>`;
            display.value = formatNumberWithCommas(result);
            history.scrollTop = history.scrollHeight;
        } catch (error) {
            display.value = '오류';
            lastOperations[calcId] = null;
        }
    }
    </script>
</body>

</html>