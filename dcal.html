<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EQ L/S Dual Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="container mx-auto p-2 md:p-4">
        <h1 class="text-xl md:text-3xl font-bold text-center mb-4 md:mb-8">EQ L/S Dual Calculator</h1>
        <div class="flex flex-col md:flex-row gap-2 md:gap-4 justify-center">
            <!-- 계산기 1 -->
            <div class="bg-white p-2 md:p-6 rounded-lg shadow-lg w-full md:w-1/2 max-w-md">
                <h2 class="text-lg md:text-xl font-semibold mb-2 md:mb-4 text-center">보통주 스케일[S]</h2>
                <input type="text" id="display1"
                    class="w-full p-2 mb-2 md:mb-4 border rounded text-right text-lg md:text-xl"
                    oninput="formatDisplay(1)">
                <div class="grid grid-cols-4 gap-1 md:gap-2">
                    <button onclick="clearDisplay(1)" class="bg-green-500 text-white p-2 md:p-3 rounded">C</button>
                    <button onclick="backspace(1)" class="bg-yellow-500 text-white p-2 md:p-3 rounded">←</button>
                    <button onclick="appendToDisplay(1, '(')" class="bg-gray-200 p-2 md:p-3 rounded">(</button>
                    <button onclick="appendToDisplay(1, ')')" class="bg-gray-200 p-2 md:p-3 rounded">)</button>
                    <button onclick="appendToDisplay(1, '7')" class="bg-gray-100 p-2 md:p-3 rounded">7</button>
                    <button onclick="appendToDisplay(1, '8')" class="bg-gray-100 p-2 md:p-3 rounded">8</button>
                    <button onclick="appendToDisplay(1, '9')" class="bg-gray-100 p-2 md:p-3 rounded">9</button>
                    <button onclick="appendToDisplay(1, '/')" class="bg-gray-200 p-2 md:p-3 rounded">/</button>
                    <button onclick="appendToDisplay(1, '4')" class="bg-gray-100 p-2 md:p-3 rounded">4</button>
                    <button onclick="appendToDisplay(1, '5')" class="bg-gray-100 p-2 md:p-3 rounded">5</button>
                    <button onclick="appendToDisplay(1, '6')" class="bg-gray-100 p-2 md:p-3 rounded">6</button>
                    <button onclick="appendToDisplay(1, '*')" class="bg-gray-200 p-2 md:p-3 rounded">×</button>
                    <button onclick="appendToDisplay(1, '1')" class="bg-gray-100 p-2 md:p-3 rounded">1</button>
                    <button onclick="appendToDisplay(1, '2')" class="bg-gray-100 p-2 md:p-3 rounded">2</button>
                    <button onclick="appendToDisplay(1, '3')" class="bg-gray-100 p-2 md:p-3 rounded">3</button>
                    <button onclick="appendToDisplay(1, '-')" class="bg-gray-200 p-2 md:p-3 rounded">-</button>
                    <button onclick="appendToDisplay(1, '0')"
                        class="bg-gray-100 p-2 md:p-3 rounded col-span-2">0</button>
                    <button onclick="appendToDisplay(1, '.')" class="bg-gray-100 p-2 md:p-3 rounded">.</button>
                    <button onclick="appendToDisplay(1, '+')" class="bg-gray-200 p-2 md:p-3 rounded">+</button>
                    <button onclick="calculate(1)"
                        class="bg-blue-500 text-white p-2 md:p-3 rounded col-span-4">=</button>
                </div>
                <div class="mt-2 md:mt-4">
                    <h3 class="text-base md:text-lg font-medium">Input History</h3>
                    <div id="history1"
                        class="bg-gray-50 p-1 md:p-2 rounded h-20 md:h-24 overflow-y-auto text-sm md:text-base"></div>
                    <button onclick="clearHistory(1)"
                        class="mt-1 md:mt-2 bg-red-500 text-white p-2 md:p-3 rounded w-full">Delete All</button>
                </div>
            </div>
            <!-- 계산기 2 -->
            <div class="bg-white p-2 md:p-6 rounded-lg shadow-lg w-full md:w-1/2 max-w-md">
                <h2 class="text-lg md:text-xl font-semibold mb-2 md:mb-4 text-center">우선주 스케일[L]</h2>
                <input type="text" id="display2"
                    class="w-full p-2 mb-2 md:mb-4 border rounded text-right text-lg md:text-xl"
                    oninput="formatDisplay(2)">
                <div class="grid grid-cols-4 gap-1 md:gap-2">
                    <button onclick="clearDisplay(2)" class="bg-green-500 text-white p-2 md:p-3 rounded">C</button>
                    <button onclick="backspace(2)" class="bg-yellow-500 text-white p-2 md:p-3 rounded">←</button>
                    <button onclick="appendToDisplay(2, '(')" class="bg-gray-200 p-2 md:p-3 rounded">(</button>
                    <button onclick="appendToDisplay(2, ')')" class="bg-gray-200 p-2 md:p-3 rounded">)</button>
                    <button onclick="appendToDisplay(2, '7')" class="bg-gray-100 p-2 md:p-3 rounded">7</button>
                    <button onclick="appendToDisplay(2, '8')" class="bg-gray-100 p-2 md:p-3 rounded">8</button>
                    <button onclick="appendToDisplay(2, '9')" class="bg-gray-100 p-2 md:p-3 rounded">9</button>
                    <button onclick="appendToDisplay(2, '*')" class="bg-gray-200 p-2 md:p-3 rounded">×</button>
                    <button onclick="appendToDisplay(2, '4')" class="bg-gray-100 p-2 md:p-3 rounded">4</button>
                    <button onclick="appendToDisplay(2, '5')" class="bg-gray-100 p-2 md:p-3 rounded">5</button>
                    <button onclick="appendToDisplay(2, '6')" class="bg-gray-100 p-2 md:p-3 rounded">6</button>
                    <button onclick="appendToDisplay(2, '-')" class="bg-gray-200 p-2 md:p-3 rounded">-</button>
                    <button onclick="appendToDisplay(2, '1')" class="bg-gray-100 p-2 md:p-3 rounded">1</button>
                    <button onclick="appendToDisplay(2, '2')" class="bg-gray-100 p-2 md:p-3 rounded">2</button>
                    <button onclick="appendToDisplay(2, '3')" class="bg-gray-100 p-2 md:p-3 rounded">3</button>
                    <button onclick="appendToDisplay(2, '+')" class="bg-gray-200 p-2 md:p-3 rounded">+</button>
                    <button onclick="appendToDisplay(2, '0')"
                        class="bg-gray-100 p-2 md:p-3 rounded col-span-2">0</button>
                    <button onclick="appendToDisplay(2, '.')" class="bg-gray-100 p-2 md:p-3 rounded">.</button>
                    <button onclick="calculate(2)"
                        class="bg-blue-500 text-white p-2 md:p-3 rounded col-span-2">=</button>
                </div>
                <div class="mt-2 md:mt-4">
                    <h3 class="text-base md:text-lg font-medium">Input History</h3>
                    <div id="history2"
                        class="bg-gray-50 p-1 md:p-2 rounded h-20 md:h-24 overflow-y-auto text-sm md:text-base"></div>
                    <button onclick="clearHistory(2)"
                        class="mt-1 md:mt-2 bg-red-500 text-white p-2 md:p-3 rounded w-full">Delete All</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        // 각 계산기의 마지막 연산을 저장
        const lastOperations = { 1: null, 2: null };

        // 천단위 콤마 추가 함수
        function formatNumber(number) {
            if (isNaN(number)) return number;
            return Number(number).toLocaleString('en-US', { maximumFractionDigits: 10 });
        }

        // 디스플레이에 천단위 콤마를 추가하는 함수
        function formatDisplay(calcId) {
            const display = document.getElementById(`display${calcId}`);
            let value = display.value.replace(/,/g, ''); // 기존 콤마 제거
            // 숫자만 있는 경우에만 포맷팅
            if (!isNaN(parseFloat(value)) && !/[+\-*/()]/.test(value)) {
                display.value = formatNumber(value);
            } else {
                display.value = value; // 연산자나 괄호가 포함된 경우 그대로 유지
            }
        }

        function appendToDisplay(calcId, value) {
            const display = document.getElementById(`display${calcId}`);
            display.value += value;
            formatDisplay(calcId);
        }

        function clearDisplay(calcId) {
            const display = document.getElementById(`display${calcId}`);
            display.value = '';
            lastOperations[calcId] = null; // 연산 초기화
        }

        function backspace(calcId) {
            const display = document.getElementById(`display${calcId}`);
            display.value = display.value.slice(0, -1);
        }

        function clearHistory(calcId) {
            const history = document.getElementById(`history${calcId}`);
            history.innerHTML = '';
        }

        function deleteHistoryEntry(calcId, index) {
            const history = document.getElementById(`history${calcId}`);
            const entries = history.getElementsByTagName('div');
            if (entries[index]) {
                entries[index].remove();
            }
        }

        function calculate(calcId) {
            const display = document.getElementById(`display${calcId}`);
            const history = document.getElementById(`history${calcId}`);
            try {
                // 디스플레이에서 콤마 제거
                let expression = display.value.replace(/,/g, '');

                // 디스플레이에 숫자만 있는 경우 (이전 연산 결과)
                if (lastOperations[calcId] && !isNaN(parseFloat(expression))) {
                    const lastOp = lastOperations[calcId];
                    const newExpression = `${expression}${lastOp}`;
                    const result = eval(newExpression.replace('×', '*'));
                    const formattedResult = formatNumber(result);
                    const entryIndex = history.getElementsByTagName('div').length;
                    history.innerHTML += `
                        <div class="history-entry flex justify-between items-center">
                            <p>${newExpression.replace('*', '×')} = ${formattedResult}</p>
                            <button onclick="deleteHistoryEntry(${calcId}, ${entryIndex})" class="history-delete bg-orange-400 text-white p-1 md:p-2 rounded">Delete</button>
                        </div>`;
                    display.value = formattedResult;
                    history.scrollTop = history.scrollHeight;
                    return;
                }

                // 새로운 연산 처리
                expression = expression.replace('×', '*');
                const result = eval(expression); // 실제 프로덕션에서는 안전한 파서 사용 권장
                const formattedResult = formatNumber(result);
                const entryIndex = history.getElementsByTagName('div').length;

                // 마지막 연산자 및 숫자 추출 (예: "5*5" -> "*5")
                const match = expression.match(/([+\-*/])([^+\-*/()]+)$/);
                lastOperations[calcId] = match ? match[1] + match[2] : null;

                history.innerHTML += `
                    <div class="history-entry flex justify-between items-center">
                        <p>${expression.replace('*', '×')} = ${formattedResult}</p>
                        <button onclick="deleteHistoryEntry(${calcId}, ${entryIndex})" class="history-delete bg-orange-400 text-white p-1 md:p-2 rounded">Delete</button>
                    </div>`;
                display.value = formattedResult;
                history.scrollTop = history.scrollHeight;
            } catch (error) {
                display.value = '오류';
                lastOperations[calcId] = null;
            }
        }
    </script>
</body>

</html>